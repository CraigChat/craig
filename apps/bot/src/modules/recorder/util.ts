import { RawData } from 'ws';

export const EMPTY_BUFFER = Buffer.alloc(0);

export const OPUS_HEADERS = [
  Buffer.from([
    0x4f, 0x70, 0x75, 0x73, 0x48, 0x65, 0x61, 0x64, 0x01, 0x02, 0x00, 0x0f, 0x80, 0xbb, 0x00, 0x00, 0x00, 0x00, 0x00
  ]),
  Buffer.from([
    0x4f, 0x70, 0x75, 0x73, 0x54, 0x61, 0x67, 0x73, 0x09, 0x00, 0x00, 0x00, 0x6e, 0x6f, 0x64, 0x65, 0x2d, 0x6f, 0x70,
    0x75, 0x73, 0x00, 0x00, 0x00, 0x00, 0xff
  ])
];

export const VAD_HEADER = Buffer.from([0x45, 0x43, 0x56, 0x41, 0x44, 0x44, 0x03, 0x00, 0x00, 0x03, 0x01]);

export const OPUS_HEADERS_MONO = [
  Buffer.from([
    0x4f, 0x70, 0x75, 0x73, 0x48, 0x65, 0x61, 0x64, 0x01, 0x01, 0x38, 0x01, 0x80, 0xbb, 0x00, 0x00, 0x00, 0x00, 0x00
  ]),
  Buffer.from([
    0x4f, 0x70, 0x75, 0x73, 0x54, 0x61, 0x67, 0x73, 0x0a, 0x00, 0x00, 0x00, 0x65, 0x6e, 0x6e, 0x75, 0x69, 0x63, 0x61,
    0x73, 0x74, 0x72
  ])
];
export const OPUS_MONO_HEADER_VAD = Buffer.concat([VAD_HEADER, OPUS_HEADERS_MONO[0]]);

// A precompiled FLAC header, modified from one made by flac
export const FLAC_HEADER_48k = Buffer.from([
  0x7f, 0x46, 0x4c, 0x41, 0x43, 0x01, 0x00, 0x00, 0x03, 0x66, 0x4c, 0x61, 0x43, 0x00, 0x00, 0x00, 0x22, 0x03, 0xc0,
  0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0xb8, 0x01, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
]);
export const FLAC_HEADER_48k_VAD = Buffer.concat([VAD_HEADER, FLAC_HEADER_48k]);

// A precompiled FLAC header for 44.1k
export const FLAC_HEADER_44k = Buffer.from([
  0x7f, 0x46, 0x4c, 0x41, 0x43, 0x01, 0x00, 0x00, 0x03, 0x66, 0x4c, 0x61, 0x43, 0x00, 0x00, 0x00, 0x22, 0x03, 0x72,
  0x03, 0x72, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0xc4, 0x41, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
]);
export const FLAC_HEADER_44k_VAD = Buffer.concat([VAD_HEADER, FLAC_HEADER_44k]);

// FLAC tags to say we're ennuicastr
export const FLAC_TAGS = Buffer.from([
  0x04, 0x00, 0x00, 0x41, 0x0a, 0x00, 0x00, 0x00, 0x65, 0x6e, 0x6e, 0x75, 0x69, 0x63, 0x61, 0x73, 0x74, 0x72
]);

export function toBuffer(data: RawData) {
  if (data instanceof Buffer) return data;
  if (Array.isArray(data)) return Buffer.concat(data);
  return Buffer.from(data);
}
